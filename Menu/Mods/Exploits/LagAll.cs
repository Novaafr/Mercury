using Mercury.Patches;
using Photon.Pun;
using Photon.Realtime;
using Mercury.Menu;
using UnityEngine;

namespace Mercury.Mods
{
    public class LagAll : MonoBehaviour
    {
        float TimeDelay;
        public void Update()
        {
            if (PluginConfig.lagall)
            {
                if (Time.time > TimeDelay)
                {
                    if (PhotonNetwork.InRoom)
                    {
                        for (int i = 0; i < 10; i++)
                        {
                            NetworkSystemRaiseEvent.RaiseEvent(51, PhotonNetwork.Server, new NetEventOptions
                            {
                                Flags = new WebFlags(byte.MaxValue),
                                Reciever = NetEventOptions.RecieverTarget.others
                            }, false);
                        }
                        RPCProtection.SkiddedRPCProtection();
                    }
                    TimeDelay = Time.time + 0.085f;
                }
            }
            else
            {
                GameObject.Destroy(Plugin.holder.GetComponent<LagAll>());
            }
        }
    }
}
